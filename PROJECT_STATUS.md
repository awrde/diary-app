# 📱 피드백 주는 일기장 (AI Diary App) - 프로젝트 현황 보고서

## 해야할 것 
 
1. 🏗️ **실제 AI API 연동**: Gemini 2.0 Flash 지원 (향후 3.0 확장성 고려)
2. 🔒 **무료 사용 제한**: 스토어 출시 시 3개월간 최대 100개 일기까지 무료 제공 로직 구현
- [x] **IndexedDB 전환**: LocalStorage에서 Dexie.js 기반 IndexedDB로 데이터 저장소 마이그레이션 및 데이터 무결성 확보.
- [x] **Gemini API 연동**: Google Gemini 모델(2.0 Flash 등) 통합 및 실시간 일기 분석 기능 구현.
- [x] **구독 티어 시스템**: 무료(100개 제한) 및 Pro 플랜 구분, 개발자 공용 API 키 fallback 로직 구현.
- [x] **디버그 및 테스트 도구**: 분석 프롬프트 확인 기능(Debug Mode) 및 사용량 제한 테스트 기능 구현.
3. 🎨 **대시보드 개선**: 최근 7개 일기 종합 점수/긍정 지수 표시, 차트 가독성 향상 (세로 막대바)
4. 📱 **플레이 스토어 등록**: 신원 인증 완료 후 .aab 업로드
5. 🔍 **필터링 강화**: 감정별, 주제별 필터링 기능 추가
6. ☁️ **데이터 백업/복구**: 기기 간 데이터 이전 기능 지원
7. 📍 **부가 기능**: 위치 기반 날씨 자동 입력, 튜토리얼, 랭킹 시스템 등

## 🛠️ 진행 중 및 예정 사항 (Roadmap)
- [ ] **On-Device LLM 검토**: 프라이버시 및 비용 절감을 위해 클라이언트 사이드에서 작동하는 가벼운 모델(WASM 등) 도입 검토.
- [ ] **평가 지표 고도화**: 점수 부여 기준을 구체화하고 AI 정렬(Alignment)을 통해 더 정확한 분석 제공.
- [ ] **사용자 경험(UX) 강화**: 사람이 작성한 느낌을 주는 인터랙티브 요소 및 일기 작성 유도 장치 고도화.
- [ ] **결제 시스템 실연동**: Stripe/RevenueCat 등을 통한 실제 Pro 유료 결제 플로우 구현.
- [ ] **멀티 디바이스 동기화**: Supabase/Firebase 기반 서버 동기화 및 회원가입 기능.

---

## 🧾 코드/UX 리뷰 메모 (2025-12-23)
- **접근성(Viewport)**: `maximumScale: 1`, `userScalable: false` 제거하여 화면 확대 허용 → 저시력 사용성 개선.
- **내비게이션 일관성**: 대시보드 “전체 보기”를 Next `<Link>`로 변경 → 클라이언트 내비게이션/상태 보존.
- **모달 접근성(제안)**: `AnalysisModal`/`DatePickerModal`에 `aria-modal`, `role="dialog"`, 포커스 트랩, ESC 닫기, 포커스 리턴 적용 필요.
- **로딩/에러 상태(제안)**: `useLiveQuery` 초기 로딩 시 스켈레톤/스피너, 분석 실패·무료 제한 시 토스트/배너로 안내.
- **데이터 모델(제안)**: 향후 동기화/다중 사용자 대비 `userId`, `updatedAt` 컬럼 및 인덱스 추가 검토.

## 🧭 오늘 진행한 추가 작업 (데이터/설정)
- **DB 스키마 v2**: `diaries` 인덱스에 `userId`, `updatedAt` 추가. 기존 데이터는 `local-user`와 현재 시각으로 마이그레이션.
- **동기화 헬퍼 추가**: `getSyncPayload(since)`로 `updatedAt` 이후 변경분 추출, `applySyncPatch(patch, userId)`로 외부 패치 적용 및 `userId` 매핑 지원.
- **백업/복원 안전화**: 백업/목데이터/복원 시 `userId`/`updatedAt` 기본값을 주입해 무결성 유지.
- **설정/작성 안내**: 설정·작성 화면에 무료 한도 및 개인 Gemini 키 등록 안내 배너 추가, 설정 링크/발급 링크 노출.

---

## 1. 프로젝트 개요
사용자의 하루를 기록하면 **Gemini AI**가 내용을 정밀 분석하여 **감정 상태, 주요 관심사, 맞춤형 피드백**을 제공하는 **Android 기반 하이브리드 앱**입니다. 
*(기본은 키워드 기반 모의 분석을 제공하며, API 키 등록 시 실제 AI 기능을 사용할 수 있습니다.)*

---

## 2. 핵심 기능

### 📝 일기 작성 (Writing)
- **텍스트 기록**: 자유로운 형식의 일기 작성.
- **사진 첨부**: 최대 **3장**까지 사진 첨부 가능 (미리보기 및 삭제 기능 제공).
- **AI 성격 선택**: 
    - 따뜻한 공감형 (Warm Companion)
    - 발전 코치형 (Growth Coach)
    - 객관적 관찰자형 (Neutral Observer)
    - *각 성격별 예시 문구 제공*
- **수정 모드**: 작성한 일기의 내용을 수정하고 **즉시 재분석** 받을 수 있음.

### 🧠 AI 분석 (Analysis Logic)
*본 앱은 키워드 매칭 및 규칙 기반 알고리즘을 사용하여 AI 분석을 시뮬레이션합니다.*

1.  **감정 분석 (Emotion Scoring)**
    *   **0점 시작**: 긍정(Positive)와 부정(Negative) 점수는 **0점**에서 시작.
    *   **키워드 감지**: 대폭 확장된 단어 사전을 통해 긍정/부정 단어 빈도를 체크.
    *   **스코어링**: 
        *   긍정 단어 발견 시 +8점 / 부정 단어 발견 시 +8점.
        *   최종적으로 **긍정 vs 부정의 밸런스**를 계산하여 상태 판단.

2.  **주제 및 키워드 분석 (Topic Detection)**
    *   5가지 카테고리 감지: **경제(Money), 건강(Health), 관계(Relationship), 업무/성장(Work), 취미(Hobby)**.
    *   단순 유무가 아닌 **빈도수(Frequency)**를 체크하여 **가장 지배적인 주제(Dominant Topic)**를 선정.
    *   **경제/투자 특화**: '투자', '증시', '관세', '자산' 등 전문 키워드 감지 기능 강화.

3.  **동적 요약 (Dynamic Summary)**
    *   감지된 핵심 주제와 감정 상태를 조합하여 요약 문구를 동적으로 생성.
    *   예: "투자와 자산 관리에 깊은 관심을 기울이며..." (경제 키워드 많을 시)

4.  **맞춤형 피드백 (Feedback Generation)**
    *   **주제별 피드백**: 경제, 업무, 건강 등 특정 주제가 강할 경우 맞춤 조언 제공.
    *   **감정 세분화 피드백**: (긍정 - 부정) 점수 차이에 따라 **6단계**로 쪼개진 섬세한 피드백 제공.
        *   *매우 긍정 / 긍정 / 복합적(치열함) / 평온 / 부정 / 매우 부정*

### 📊 대시보드 (Dashboard)
- **종합 점수**: 가중치가 반영된 오늘의 종합 점수 표시.
- **감정 분포**: 최근 일기들의 감정을 **아이콘(Lucide Icon)**으로 시각화.
- **통계 차트**: 긍정, 조금, 보통, 흐림 등 날씨/표정 아이콘으로 직관적 표현.

---

## 3. UI/UX 개선 사항 (Recent Updates)

### 🎨 시각적 개선 (Visuals)
- **이모티콘 가독성 강화**: 기존 텍스트 이모지(😊)를 **Lucide React 아이콘(컬러 적용)**으로 전면 교체.
    - 😄 **행복**: 초록색 (`Laugh`)
    - 🙂 **좋음**: 파란색 (`Smile`)
    - 😐 **보통**: 노란색 (`Meh`)
    - 😞 **우울**: 빨간색 (`Frown`)
- **감정 분석 바 (Radar -> Bar)**: 
    - 복잡한 방사형 차트 대신 **부정(좌) <-> 긍정(우)** 형태의 **수평 바(Linear Bar)** UI 적용.
    - 0점을 기준으로 바늘이 움직이는 직관적인 디자인.
- **상세 분석 모달**: 불필요한 텍스트 수치를 제거하고 시각적 요소(Bar)에 집중.

### 🛠 기능적 개선 (Usability)
- **삭제/수정 기능**:
    - 모달 내 **[수정]**, **[삭제]** 버튼 활성화.
    - **안전한 삭제 UX**: 삭제 버튼 클릭 시 '정말 삭제하시겠습니까?' 확인 버튼으로 전환되는 **2단계 인-모달(In-Modal) UI** 적용 (Native Confirm 문제 해결).
    - **취소 기능**: 삭제 확인 상태에서는 [수정] 버튼이 **[취소]** 버튼으로 전환되어 안전하게 복귀 가능.
    - 수정 시 기존 내용과 이미지를 불러오며, 저장 시 **무조건 재분석** 수행.
- **사진 관리**: 업로드된 이미지의 미리보기 및 개별 삭제 버튼(X) 추가.

---

## 4. 기술 스택 (Tech Stack)
- **Framework**: Next.js 14+ (App Router)
- **Hybrid App**: Capacitor 6 (Android)
- **Styling**: Pure CSS Modules (Glassmorphism Design)
- **Storage**: IndexedDB (Dexie.js) - 대용량/비동기 데이터 영구 저장 (Robust Storage)
- **Icons**: Lucide React

---

## 5. 데이터 구조 (Data Structure)

```javascript
{
  id: 1702451234,
  date: "2024-03-20",
  content: "오늘은 주식 시장이 반등해서 기분이 좋다...",
  images: ["data:image/png;base64,..."], // Base64 인코딩된 이미지
  personality: "growth_coach",
  analysis: {
    summary: "투자와 자산 관리에 집중한 하루...",
    emotionalScore: {
      positive: 45, // 0점부터 시작
      negative: 0,
      neutral: 55
    },
    metricScores: {
      health: 3,
      money: 5, // 키워드 빈도에 따른 가산점
      relationship: 3,
      growth: 3,
      rest: 2,
      hobby: 3,
      work: 3
    },
    feedback: "경제적 자유를 향한 꾸준한 공부와..."
  }
}
```
